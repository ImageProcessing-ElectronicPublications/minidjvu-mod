This code is a kluge and should be replaced with a full IFF walker.
